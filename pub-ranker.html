<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reading Ale Trail 2026 ‚Äî Pub Ranker</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #F7F6F3;
    --surface: #ffffff;
    --border: #E4E2DC;
    --text: #1C1B18;
    --muted: #8C8A84;
    --accent: #2D6A4F;
    --accent-light: #EAF2EE;
    --danger: #C0392B;
    --radius: 12px;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem 1rem 4rem;
    color: var(--text);
  }

  .app { width: min(780px, 100%); }

  .header {
    text-align: center;
    margin-bottom: 2rem;
    padding-top: 1rem;
  }
  .header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(1.6rem, 4vw, 2.2rem);
    font-weight: 400;
    letter-spacing: -0.01em;
  }
  .header p { color: var(--muted); font-size: 0.9rem; margin-top: 0.3rem; }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.75rem;
    display: none;
  }
  .card.active { display: block; animation: fadeUp 0.3s ease; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .card-label {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 1.25rem;
  }

  .btn {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    font-weight: 500;
    border: none;
    border-radius: 7px;
    cursor: pointer;
    padding: 0.6rem 1rem;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .btn-primary {
    background: var(--accent);
    color: #fff;
    width: 100%;
    padding: 0.75rem;
    font-size: 0.95rem;
  }
  .btn-primary:hover { background: #235c42; }
  .btn-ghost {
    background: var(--bg);
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-ghost:hover { background: var(--border); }

  /* PROGRESS */
  .progress-wrap { margin-bottom: 1.5rem; }
  .progress-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.78rem;
    color: var(--muted);
    margin-bottom: 0.45rem;
  }
  .progress-bar { height: 2px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.35s ease; }

  /* COMPARE */
  .compare-layout {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: stretch;
  }

  .pub-card {
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: border-color 0.15s, background 0.15s, transform 0.1s;
    user-select: none;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .pub-card:hover { border-color: var(--accent); background: var(--accent-light); }
  .pub-card:active { transform: scale(0.98); }

  .pub-img {
    width: 100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    display: block;
    background: var(--border);
  }
  .pub-img-placeholder {
    width: 100%;
    aspect-ratio: 4/3;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
  }
  .pub-card-body {
    padding: 0.9rem;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .pub-card .name {
    font-size: 0.95rem;
    font-weight: 500;
    line-height: 1.3;
    text-align: center;
    color: var(--text);
  }

  .vs-col {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 0.25rem;
  }
  .vs {
    font-size: 0.68rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--muted);
  }

  /* STREAK */
  .streak-banner {
    text-align: center;
    font-size: 0.82rem;
    color: var(--accent);
    font-weight: 500;
    margin-top: 1rem;
    min-height: 1.2em;
  }

  /* LEADERBOARD */
  .leaderboard-wrap {
    margin-top: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--border);
  }
  .leaderboard-label {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.75rem;
  }
  .leaderboard-list { list-style: none; }
  .leaderboard-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.45rem 0;
    border-bottom: 1px solid var(--border);
    font-size: 0.85rem;
  }
  .leaderboard-item:last-child { border-bottom: none; }
  .lb-rank {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--muted);
    min-width: 1.25rem;
    text-align: right;
  }
  .lb-rank.top { color: var(--accent); }
  .lb-name { flex: 1; color: var(--text); }
  .lb-thumb {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    object-fit: cover;
    background: var(--border);
    flex-shrink: 0;
  }

  /* RESULTS */
  .results-list { list-style: none; }
  .result-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.65rem 0;
    border-bottom: 1px solid var(--border);
    animation: fadeUp 0.25s ease both;
  }
  .result-item:last-child { border-bottom: none; }
  .result-thumb {
    width: 44px;
    height: 44px;
    border-radius: 6px;
    object-fit: cover;
    background: var(--border);
    flex-shrink: 0;
  }
  .rank-num {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--muted);
    min-width: 1.5rem;
    text-align: right;
  }
  .rank-num.top { color: var(--accent); }
  .result-name { flex: 1; font-size: 0.9rem; }
  .medal { font-size: 1rem; }

  /* SHARE */
  .share-area {
    margin-top: 1.25rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--border);
  }
  .share-label {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.6rem;
  }
  .share-text {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 7px;
    padding: 0.85rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.82rem;
    color: var(--text);
    line-height: 1.8;
    white-space: pre-wrap;
    margin-bottom: 0.75rem;
  }
  .btn-row { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
  .copied-msg { font-size: 0.8rem; color: var(--accent); display: none; }

  @media (max-width: 480px) {
    .compare-layout { grid-template-columns: 1fr; }
    .vs-col { display: none; }
    .pub-img, .pub-img-placeholder { aspect-ratio: 16/9; }
  }
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <h1>Reading Ale Trail 2026</h1>
    <p>Rank your pubs ‚Äî one head-to-head at a time</p>
  </div>

  <!-- INTRO -->
  <div class="card active" id="panel-intro">
    <div class="card-label">Ready to rank?</div>
    <p style="color:var(--muted);font-size:0.9rem;margin-bottom:1.25rem;line-height:1.6;">
      You'll be shown two pubs at a time. Just pick whichever you'd rather visit.
      After ~90 comparisons you'll have your definitive Reading Ale Trail ranking.
    </p>
    <button class="btn btn-primary" onclick="startRanking()">Let's go üç∫</button>
  </div>

  <!-- COMPARE -->
  <div class="card" id="panel-compare">
    <div class="progress-wrap">
      <div class="progress-meta">
        <span>Which would you rather visit?</span>
        <span id="compare-count"></span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>

    <div class="compare-layout">
      <div class="pub-card" id="card-a" onclick="choose('a')">
        <div id="img-a-wrap"></div>
        <div class="pub-card-body"><div class="name" id="name-a">‚Äî</div></div>
      </div>
      <div class="vs-col"><div class="vs">or</div></div>
      <div class="pub-card" id="card-b" onclick="choose('b')">
        <div id="img-b-wrap"></div>
        <div class="pub-card-body"><div class="name" id="name-b">‚Äî</div></div>
      </div>
    </div>

    <div class="streak-banner" id="streak-banner"></div>

    <div class="leaderboard-wrap">
      <div class="leaderboard-label">Live rankings</div>
      <ul class="leaderboard-list" id="leaderboard"></ul>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="card" id="panel-results">
    <div class="card-label">Your final rankings</div>
    <ol class="results-list" id="results-list"></ol>
    <div class="share-area">
      <div class="share-label">Share</div>
      <div class="share-text" id="share-text"></div>
      <div class="btn-row">
        <button class="btn btn-ghost" onclick="copyResults()">Copy to clipboard</button>
        <button class="btn btn-ghost" onclick="restart()">Start again</button>
        <span class="copied-msg" id="copied-msg">Copied!</span>
      </div>
    </div>
  </div>
</div>

<script>
const BASE = "https://raw.githubusercontent.com/julietbbb/ale_trial_reading2026/main/Images/";

const PUBS = [
  { name: "Alehouse, Reading",                        img: BASE + "Alehouse.jpeg" },
  { name: "Bell, Waltham St Lawrence",                img: BASE + "Bell, Waltham St Lawrence.jpeg" },
  { name: "Bull Inn, Sonning",                        img: BASE + "Bull Inn, Sonning.jpeg" },
  { name: "Castle Inn, Hurst",                        img: BASE + "Castle Inn, Hurst.jpeg" },
  { name: "Elm Tree, Beech Hill",                     img: BASE + "Elm Tree, Beech Hill.jpeg" },
  { name: "Farriers Arms, Spencers Wood",             img: BASE + "Farriers Arms.jpeg" },
  { name: "Foresters Arms, Reading",                  img: BASE + "Foresters Arms, Reading.jpeg" },
  { name: "Fox & Hounds, Sheffield Bottom",           img: BASE + "Fox & Hounds, Sheffield Bottom.jpeg" },
  { name: "Fox & Hounds, Tilehurst",                  img: BASE + "Fox & Hounds.jpeg" },
  { name: "Greyfriar, Reading",                       img: BASE + "Greyfriar.jpeg" },
  { name: "Lyndhurst, Reading",                       img: BASE + "Lyndhurst, Reading.jpeg" },
  { name: "Nags Head, Reading",                       img: BASE + "Nags Head.jpeg" },
  { name: "Park House, Reading",                      img: BASE + "Park House, Reading.jpeg" },
  { name: "Railway Tavern, Reading",                  img: BASE + "Railway Tavern.jpeg" },
  { name: "Retreat, Reading",                         img: BASE + "Retreat.jpeg" },
  { name: "Royal Oak, Tilehurst",                     img: BASE + "Royal Oak, Tilehurst.jpeg" },
  { name: "Six Bells, Burghfield",                    img: BASE + "Six Bells, Burghfield.jpeg" },
  { name: "The Bull Inn, Arborfield Cross",           img: BASE + "The Bull Inn, Arborfield Cross.jpeg" },
  { name: "The Flowing Spring, Playhatch",            img: BASE + "The Flowing Spring, Playhatch (South Oxfordshire Branch).jpeg" },
  { name: "The Sun, Whitchurch Hill",                 img: BASE + "The Sun, Whitchurch Hill (South Oxfordshire Branch).jpeg" },
  { name: "The Swan, Pangbourne",                     img: BASE + "The Swan, Pangbourne.jpeg" },
];

let compareIndex = 0;
let totalComparisons = 0;
let state = null;
let lastWinner = null;
let streakCount = 0;

function estimateComparisons(n) {
  let t = 0;
  for (let i = 1; i < n; i++) t += Math.ceil(Math.log2(i + 1));
  return Math.max(t, 1);
}

function startRanking() {
  const arr = [...PUBS].sort(() => Math.random() - 0.5);
  state = {
    sorted: [arr[0]],
    remaining: arr.slice(1),
    currentItem: arr[1],
    lo: 0,
    hi: 0
  };
  state.hi = state.sorted.length - 1;
  totalComparisons = estimateComparisons(arr.length);
  compareIndex = 0;
  lastWinner = null;
  streakCount = 0;
  showPanel('compare');
  showNext();
}

function renderImg(wrapId, pub) {
  const wrap = document.getElementById(wrapId);
  const img = document.createElement('img');
  img.className = 'pub-img';
  img.src = pub.img;
  img.alt = pub.name;
  img.onerror = () => {
    wrap.innerHTML = '<div class="pub-img-placeholder">üç∫</div>';
  };
  wrap.innerHTML = '';
  wrap.appendChild(img);
}

function showNext() {
  if (state.remaining.length === 0) { showResults(); return; }
  if (state.lo > state.hi) {
    state.sorted.splice(state.lo, 0, state.currentItem);
    state.remaining.shift();
    if (state.remaining.length === 0) { showResults(); return; }
    state.currentItem = state.remaining[0];
    state.lo = 0;
    state.hi = state.sorted.length - 1;
  }
  const mid = Math.floor((state.lo + state.hi) / 2);
  document.getElementById('name-a').textContent = state.currentItem.name;
  document.getElementById('name-b').textContent = state.sorted[mid].name;
  document.getElementById('card-a').dataset.mid = mid;
  renderImg('img-a-wrap', state.currentItem);
  renderImg('img-b-wrap', state.sorted[mid]);
  updateProgress();
  renderLeaderboard();
}

function choose(side) {
  const mid = parseInt(document.getElementById('card-a').dataset.mid);
  const winner = side === 'a' ? state.currentItem : state.sorted[mid];

  if (lastWinner && winner.name === lastWinner.name) {
    streakCount++;
  } else {
    streakCount = 1;
    lastWinner = winner;
  }
  updateStreakBanner(winner.name, streakCount);

  if (side === 'a') { state.hi = mid - 1; }
  else              { state.lo = mid + 1; }
  compareIndex++;
  showNext();
}

function updateStreakBanner(name, streak) {
  const el = document.getElementById('streak-banner');
  if (streak >= 3)     el.textContent = `${name} is on a ${streak}-win streak! üî•`;
  else if (streak === 2) el.textContent = `${name} wins again!`;
  else                   el.textContent = '';
}

function updateProgress() {
  const pct = Math.min(100, Math.round((compareIndex / totalComparisons) * 100));
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('compare-count').textContent = `${compareIndex} / ~${totalComparisons}`;
}

function renderLeaderboard() {
  const list = document.getElementById('leaderboard');
  list.innerHTML = '';
  state.sorted.slice(0, 8).forEach((pub, i) => {
    const li = document.createElement('li');
    li.className = 'leaderboard-item';
    li.innerHTML = `
      <img class="lb-thumb" src="${pub.img}" alt="" onerror="this.style.display='none'">
      <span class="lb-rank ${i < 3 ? 'top' : ''}">${i + 1}</span>
      <span class="lb-name">${pub.name}</span>
    `;
    list.appendChild(li);
  });
}

function showResults() {
  const medals = ['ü•á', 'ü•à', 'ü•â'];
  const list = document.getElementById('results-list');
  list.innerHTML = '';
  state.sorted.forEach((pub, i) => {
    const li = document.createElement('li');
    li.className = 'result-item';
    li.style.animationDelay = (i * 0.05) + 's';
    const isTop = i < 3;
    li.innerHTML = `
      <img class="result-thumb" src="${pub.img}" alt="" onerror="this.style.display='none'">
      <span class="rank-num ${isTop ? 'top' : ''}">${i + 1}</span>
      <span class="result-name">${pub.name}</span>
      ${isTop ? `<span class="medal">${medals[i]}</span>` : ''}
    `;
    list.appendChild(li);
  });

  document.getElementById('share-text').textContent =
    'üç∫ My Reading Ale Trail 2026 rankings:\n' +
    state.sorted.map((p, i) => `${i + 1}. ${p.name}`).join('\n');

  showPanel('results');
}

function copyResults() {
  navigator.clipboard.writeText(document.getElementById('share-text').textContent).then(() => {
    const msg = document.getElementById('copied-msg');
    msg.style.display = 'inline';
    setTimeout(() => msg.style.display = 'none', 2000);
  });
}

function restart() {
  compareIndex = 0; state = null; lastWinner = null; streakCount = 0;
  showPanel('intro');
}

function showPanel(name) {
  document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
}
</script>
</body>
</html>
